#!/bin/bash
# Ubuntu Post-Installation Bootstrap Script
# Author: Aadil Ahmad
# Purpose: Automate setup of DevOps tools, trackpad gestures, and Nerd Fonts on a fresh Ubuntu install

set -e

# ---------- CONFIG ----------
REPO_URL="https://github.com/aadilahammad86/LinuxRelated.git"
REPO_DIR="$HOME/LinuxRelated"
SCRIPTS=("devops-setup.sh" "enable-gestures.sh" "install-ubuntu-nf-font.sh")
# ----------------------------

echo "ğŸ§  Starting Ubuntu post-install setup..."

# Check for root
if [ "$EUID" -ne 0 ]; then
  echo "âš ï¸ Please run this script with sudo:"
  echo "    sudo bash post-install.sh"
  exit 1
fi

# Step 1: Basic package update
echo "ğŸ“¦ Updating system..."
apt update -y && apt upgrade -y

# Step 2: Install base tools
echo "ğŸ§° Installing base tools (git, curl, unzip, make)..."
apt install -y git curl wget unzip make python3-pip

# Step 3: Clone your repo if missing
if [ ! -d "$REPO_DIR" ]; then
  echo "ğŸ“¥ Cloning setup repository from GitHub..."
  git clone "$REPO_URL" "$REPO_DIR"
else
  echo "ğŸ” Repo already exists. Pulling latest changes..."
  cd "$REPO_DIR"
  git pull
fi

cd "$REPO_DIR"

# Step 4: Make all scripts executable
echo "âš™ï¸ Setting execute permissions..."
chmod +x "${SCRIPTS[@]}"

# Step 5: Run each setup script
for SCRIPT in "${SCRIPTS[@]}"; do
  echo "ğŸš€ Running $SCRIPT ..."
  bash "$SCRIPT"
done

# Step 6: Cleanup and final status
echo "âœ… All setup scripts executed successfully."
echo "â¡ï¸ You may reboot your system to apply all changes."
echo "ğŸ’¡ Next steps: Verify gestures and fonts, open your terminal and code editor."

sleep 2
read -p "Would you like to reboot now? (y/n): " answer
if [[ "$answer" =~ ^[Yy]$ ]]; then
  reboot
else
  echo "ğŸ•¶ï¸ Setup complete. Please reboot later to finalize configurations."
fi
